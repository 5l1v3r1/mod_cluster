#
# Top-level Makefile for SIGHT
#

CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@

# gets substituted into some targets
SIGHT_MAJOR_VERSION=@SIGHT_MAJOR_VERSION@
SIGHT_DOTTED_VERSION=@SIGHT_DOTTED_VERSION@
SIGHT_LIBTOOL_VERSION=@SIGHT_LIBTOOL_VERSION@

srcdir = @srcdir@
VPATH = @srcdir@

# this sucks, but it's the only way to add extra flags to the LT_COMPILE
INCLUDES = @CFLAGS@ @CPPFLAGS@ @SIGHT_INCLUDES@ @SIGHT_PRIV_INCLUDES@ @APR_INCLUDES@
SIGHT_LDFLAGS = @SIGHT_LDFLAGS@
SIGHT_LIBS = @SIGHT_LIBS@

TARGET_LIB = lib@SIGHT_LIBNAME@.la
EXTRA_OS_LINK=@EXTRA_OS_LINK@
SIGHT_PCFILE = sight-$(SIGHT_MAJOR_VERSION).pc
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@

TARGETS = $(TARGET_LIB)

# bring in rules.mk for standard functionality
@INCLUDE_RULES@
@INCLUDE_OUTPUTS@
OBJECTS=@OBJECTS_PLATFORM@ $(OBJECTS_os_posix)

LINK          = $(LIBTOOL) $(LTFLAGS) --mode=link $(LT_LDFLAGS) $(COMPILE) -version-info $(SIGHT_LIBTOOL_VERSION) $(ALL_LDFLAGS) -o $@
CLEAN_SUBDIRS = test

CLEAN_TARGETS = .make.dirs
DISTCLEAN_TARGETS = config.cache config.log config.status libtool \
	build/rules.mk sight.pc
EXTRACLEAN_TARGETS = configure aclocal.m4 build-outputs.mk \
	build/apr_common.m4 build/find_apr.m4 build/install.sh \
	build/config.guess build/config.sub sight.spec

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
libdir=@libdir@
includedir=@includedir@
top_srcdir=@abs_srcdir@
top_blddir=@abs_builddir@


install: $(TARGET_LIB)
	$(APR_MKDIR) $(DESTDIR)$(includedir) $(DESTDIR)$(libdir)/pkgconfig \
		     $(DESTDIR)$(libdir) $(DESTDIR)$(bindir)
	$(INSTALL_DATA) sight.pc $(DESTDIR)$(libdir)/pkgconfig/$(SIGHT_PCFILE)
	list='$(INSTALL_SUBDIRS)'; for i in $$list; do \
		( cd $$i ; $(MAKE) DESTDIR=$(DESTDIR) install ); \
	done
	$(LIBTOOL) --mode=install $(INSTALL) -m 755 $(TARGET_LIB) $(DESTDIR)$(libdir)

$(TARGET_LIB): $(OBJECTS)
	$(LINK) @lib_target@ @SIGHT_LDFLAGS@ @SIGHT_LIBS@

check: $(TARGET_LIB)
	(cd test && $(MAKE) check)
